A linux module to measure gpio irq latency and the time it takes to toggle a 
gpio pin in an OMAP3 kernel. 

The test requires an oscope to do the actual measurements and two gpio pins
jumpered together. The pins are assumed to be already mux'd as GPIO and not 
otherwise being used.

In the code the pins are labeled TEST_PIN and IRQ_PIN. They are interchangeable.

The example in the code is using a Gumstix Overo and two convenient pins on the
expansion board headers. Substitute different pins as needed. The definitions
are at the top of the source file.

IRQ_PIN - GPIO_146
TEST_PIN - GPIO_147

Jumper IRQ_PIN to TEST_PIN and hook an oscope probe to do the 
measurement between them.


IRQ_PIN ---- TP ---- TEST_PIN
             |
           oscope


There is a file you can source to set up the environment for building using
the OE tools configured the standard gumstix way.
 
Build the module, insert it and then write 1 to do an irq latency
test or anything else to do a gpio toggle speed test.

For example:

insmod irqlat.ko

echo 1 > /dev/irqlat

or 

echo 2 > /dev/irqlat


Set your scope to trigger on a rising signal.

The program sets up IRQ_PIN as an input and irq enables it for an 
IRQ_TRIGGER_RISING signal.

I last tested with a 2.6.34 kernel.
 
For the irq latency test, the program raises TEST_PIN and in the IRQ_PIN irq 
handler, it lowers TEST_PIN again. The difference between the rise and fall of 
TEST_PIN is the irq latency, minus the time the gpio_set() call takes. I get 
values in the neighborhood of 8-9 microseconds.

For the gpio toggle test, the IRQ_PIN irq handler is not enabled and not used
in the test. The module just runs a tight loop setting TEST_PIN high then low
again for 1000 iterations. You can watch with an oscope the time this takes.
I get a number around 200 nanoseconds to go from one state to the other.

See the source code for more details.

